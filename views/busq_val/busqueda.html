{{ extend 'layoutSIRADEXloged.html'}}

{{block titulo}}
	Busqueda
{{end}}

{{block subtitulo}}
	
{{end}}


{{block contenido}}

<!-- GRAFICAS Y TABLA -->
{{try:}}
  {{if productos != () or len(productos)!=0:}}  
    <!-- GRAFICAS -->
    <h2>
      Graficas
      <span class="glyphicon glyphicon-eye-close" id="ocultar_graficas" title="Ocultar graficas"></span>
      <span class="glyphicon glyphicon-eye-open" id="ver_graficas" title="Ver graficas" style="display: none;"></span>
    </h2>

    <div class="row graficas">
      <!-- Grafica de torta -->
      <div class="col-md-6"  > 
      <center>
        <div class="tab-content card" style="text-align: center;">
          <div id="pieChart" style="width: 100%">
          </div>
          
          <button type="button" id="btn-pieChart" class="btn btn-default green btn-border" data-toggle="modal" data-target="#modalPie">
            <span class="glyphicon glyphicon-resize-full"></span> Aumentar
          </button>
        </div>
      </center> 
      </div>
      <!-- Grafica de barra -->
      <div class="col-md-6"  > 
      <center>
        <div class="tab-content card" style="text-align: center;">
          
          <div id="barChart" class="chart"></div>
          
          <button type="button" id="btn-pieChart" class="btn btn-default green btn-border" data-toggle="modal" data-target="#modalBar">
            <span class="glyphicon glyphicon-resize-full"></span> Aumentar
          </button>
        </div>
      </center> 
      </div>      
    </div>

    <!-- TABLA -->
    <h2>
      Tabla
      <span class="glyphicon glyphicon-eye-close" id="ocultar_tabla" title="Ocultar graficas"></span>
      <span class="glyphicon glyphicon-eye-open" id="ver_tabla" title="Ver graficas" style="display: none;"></span>
    </h2>

    <div class="row tabla">
      <!-- tabla -->
      <div class="col-md-12">
        <div class="tab-content card" style="text-align: center">
          <embed type="image/svg+xml" src="{{=tabla }}" style="margin-left: 0%;height: auto;width: 100%" /> 
        </div>
      </div>
    </div>
  {{pass}}
{{except:}}
{{pass}}

<!-- LISTA -->
<h2>Actividades</h2>

<div class="tab-content card">
  <div role="tabpanel" class="tab-pane active" id="esp">
  {{try:}}
    {{if len(productos) == 0:}}
      No hay actividades 
    {{else:}}
      <table class="table table-striped table-condensed table-hover sortable">
        <thead>
          <tr>
          <th>Nombre Producto</th>
          <th>Descripción</th>
          <th>Fecha</th>
          <th><center>Mostrar</center></th>
          </tr>
        </thead>
        <tbody>
          {{for producto in productos: }}
            <tr>
              <td class="detalles">
              {{=producto[1]}}
              </td>

              <td class="detalles">
              {{=producto[0]}}
              </td>

              <td class="detalles">
              {{=producto[4]}}
              </td>                                           

              <td>
              <a href="{{=URL(f='ver_producto', args=[producto[3]])}}">
              <center><span class="glyphicon glyphicon-eye-open" style="color:#9E9E9E"></span></center>
              </a>
              </td>
            </tr>
          {{pass}}
        </tbody>
      </table>
    {{pass}}
  {{except:}}
    No se ha realizado niguna búsqueda
  {{pass}}
  <div class="text-center">
    <ul class="pagination pagination-lg pager" id="myPager"></ul>
  </div>
</div>
</div>
</div>

<!-- MODALS -->
{{try:}}
<!-- Modal Pie -->
<div id="modalPie" class="modal fade" role="dialog">
  <div class="modal-dialog">

  <!-- Modal content -->
  <div class="modal-content">
    
    <div class="modal-header">
       <button type="button" class="close" data-dismiss="modal">&times;</button>
      <h4 class="modal-title"><center>Gráfica de Productos por Programa</center></h4> 
    </div>

    <div class="modal-body">
    <center>
      
      <div id="pieChartB"></div>
    </center>
    </div>
    
    <div class="modal-footer">
       <center>
      <button type="button" class="btn btn-default green btn-border " data-dismiss="modal">

        <span class="glyphicon glyphicon-resize-small"></span>
        Cerrar
        </button>
      </center> 
    </div>
  </div>
  </div>
</div>

<!-- Modal Bar -->
<div id="modalBar" class="modal fade" role="dialog">
  <div class="modal-dialog">
  <!-- Modal content -->
  <div class="modal-content">
    
    <div class="modal-header">
       <button type="button" class="close" data-dismiss="modal">&times;</button>
      <h4 class="modal-title"><center>Gráfica de Productos por Programa</center></h4> 
    </div>

    <div class="modal-body">
    <center>
      
      <div id="barChartB"></div>
    </center>
    </div>
    
    <div class="modal-footer">
       <center>
      <button type="button" class="btn btn-default green btn-border " data-dismiss="modal">
        <span class="glyphicon glyphicon-resize-small"></span>
        Cerrar
        </button>
      </center> 
    </div>
  </div>
  </div>
</div>
{{except:}}
{{pass}}
{{end}}


{{block script}}
<script>
  $(document).ready(function(){
    $("#ocultar_graficas").click(function(){
      $("#ocultar_graficas").hide();
      $("#ver_graficas").show();
      $(".graficas").toggle(300);
    });

    $("#ver_graficas").click(function(){
      $("#ver_graficas").hide();
      $("#ocultar_graficas").show();
      $(".graficas").toggle(300);
    });  

    $("#ocultar_tabla").click(function(){
      $("#ocultar_tabla").hide();
      $("#ver_tabla").show();
      $(".tabla").toggle(300);
    });

    $("#ver_tabla").click(function(){
      $("#ver_tabla").hide();
      $("#ocultar_tabla").show();
      $(".tabla").toggle(300);
    });
  });
</script>

<script type="text/javascript">
// Load the Visualization API and the corechart package.
google.charts.load('current', {'packages':['corechart']});
// Set a callback to run when the Google Visualization API is loaded.
google.charts.setOnLoadCallback(PieChart);
google.charts.setOnLoadCallback(BarChart);

// Grafica de torta
function PieChart() {
  // Inicialziar datos
  var dataTable = new google.visualization.DataTable();
  dataTable.addColumn('string', 'Programa');
  dataTable.addColumn('number', 'Productos');
  dataTable.addColumn({type: 'string', role: 'tooltip'});

  // Generar color para cada slice
  var colorsArray = [];
  {{for i in infoPieChart:}}
    dataTable.addRows([['{{=infoPieChart[i]["abreviacion"]}}',parseInt({{=infoPieChart[i]['repeticiones']}},10),'{{=infoPieChart[i]["nombre"]}}\nTotal: {{=infoPieChart[i]["repeticiones"]}}']]);
    var new_light_color = 'rgb(' +  (Math.floor((255-111)*Math.random()) + 28) + ',' + 
                                    (Math.floor((255-170)*Math.random()) + 42) + ',' + 
                                    (Math.floor((255-109)*Math.random()) + 64) + ')';
    colorsArray.push(new_light_color);
  {{pass}}

    // Set opciones de las graficas
    var options =  {'title':'Productos por Programa\n ',colors: colorsArray,backgroundColor:'transparent'};
    var options2 = {'title':'Productos por Programa\n ',colors: colorsArray,backgroundColor:'transparent'};

    // Instanciar las graficas, dibujarlas usando opciones
    var chart = new google.visualization.PieChart(document.getElementById('pieChart'));
    chart.draw(dataTable, options);

    // grafica dentro del modal
    var chartBig = new google.visualization.PieChart(document.getElementById('pieChartB'));
    chartBig.draw(dataTable, options2);

    // Agregando funcion para redirigir al hacer click
    google.visualization.events.addListener(chart, 'select', selectHandler);
    function selectHandler() {
      var selectedItem = chart.getSelection()[0];
      
      if (selectedItem) {
        var topping = dataTable.getValue(selectedItem.row, 0);
      
        {{for i in infoPieChart:}}
          if(topping == '{{=infoPieChart[i]["abreviacion"]}}'){
            window.location = "/tipo_actividad/gestionar/"+{{=infoPieChart[i]["id"]}};
          }
        {{pass}}
      }
    }
}

function BarChart() {
  var dataTable = new google.visualization.DataTable();
  dataTable.addColumn('string', 'Programa');
  dataTable.addColumn('number', 'Productos');
  dataTable.addColumn({type: 'string', role: 'tooltip'});

  var colorsArray = [];
  {{for i in infoPieChart:}}
    dataTable.addRows([['{{=infoPieChart[i]["abreviacion"]}}',parseInt({{=infoPieChart[i]['repeticiones']}},10),'{{=infoPieChart[i]["nombre"]}}\nTotal: {{=infoPieChart[i]["repeticiones"]}}']]);

    var new_light_color = 'rgb(' +  (Math.floor((255-111)*Math.random()) + 28) + ',' + 
                                    (Math.floor((255-170)*Math.random()) + 42) + ',' + 
                                    (Math.floor((255-109)*Math.random()) + 64) + ')';
    colorsArray.push(new_light_color);
  {{pass}}
    // Set opciones de las graficas
    var options =  {'title':'Productos por Programa\n ',colors: colorsArray,backgroundColor:'transparent'};
    var options2 = {'title':'Productos por Programa\n ',colors: colorsArray};

    // INstanciar las graficas, dibujarlas usando opciones
    var chart = new google.visualization.ColumnChart(document.getElementById('barChart'));
    chart.draw(dataTable, options);

    // grafica dentro del modal
    var chartBig = new google.visualization.BarChart(document.getElementById('barChartB'));
    chartBig.draw(dataTable, options2);

    // Agregando funcion para redirigir al hacer click
    google.visualization.events.addListener(chart, 'select', selectHandler);
    function selectHandler() {
      var selectedItem = chart.getSelection()[0];
      if (selectedItem) {
      var topping = dataTable.getValue(selectedItem.row, 0);
      {{for i in infoPieChart:}}
        if(topping == '{{=infoPieChart[i]["abreviacion"]}}'){ 
            window.location = "/tipo_actividad/gestionar/"+{{=infoPieChart[i]["id"]}};
          
        }
      {{pass}}
        }
    }
}

$(window).resize(function(){
  PieChart();
  BarChart();
});
</script>

<!-- SCRIPT PARA MOSTRAR Y OCULTAR DETALLES -->
<script src="{{=URL('static','js/showDetails.js')}}" type="text/javascript"></script> 

{{end}}
