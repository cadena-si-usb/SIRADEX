{{extend 'layoutSIRADEXloged.html'}}

{{block titulo}}
    Mis Productos
{{end}}

{{block subtitulo}}
    <!-- Nombre del usuario -->
    {{=session.usuario['first_name'].split(' ')[0]}} {{=session.usuario['last_name'].split(' ')[0]}}
    <!-- icono editar -->
    <a id="editar" href="{{=URL(c='default',f='EditarPerfil')}}" >
    <span class="glyphicon glyphicon-edit green-icn"></span>
    <!-- {{=IMG(_src=URL('static', 'icon', args='i_edit.png'),_style='max-height:1em') }} -->
    </a>
{{end}}

{{block descripcion}}
    <div class="row">
        <div class="col-md-3 col-md-offset-9">
        <!-- Datos del usuario -->
                <div style="margin-bottom: 0em;">
                  <button type="button" id="agregarProgBtn" class="btn btn-default green btn-border" data-toggle="modal" data-target="#myModalAgregar">
                    <span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Agregar Producto
                  </button>
                </div>
            <!-- <p class="text-justify">
            </p> -->
        </div>
    </div>
{{end}}

{{block contenido}}

<!-- Custom DataTables plugin -->
<script src="{{=URL('static','DataTables/datatables.js')}}"></script>
<link rel="stylesheet" type="text/css" href="{{=URL('static','DataTables/datatables.css')}}">

<script type="text/javascript">
  $(document).ready(function(){
    var opciones = {
      bFilter: false,
      ordering: false,
      responsive: true,
        "language": {
            search:         "Buscar:",
            searchPlaceholder: "",
            lengthMenu:     "Mostrar _MENU_ entradas",
            info:           "Mostrando _START_ a _END_ de _TOTAL_ entradas.",
            infoEmpty:      "Mostrando 0 a 0 de 0 entradas",
            infoFiltered:   "(filtradas de _MAX_ entradas en total)",
            infoPostFix:    "",
            loadingRecords: "Carga en curso...",
            zeroRecords:    "No se encontraron usuarios en la busqueda",
            emptyTable:     "No hay informacion disponible en la tabla",
            processing:     "Procesando...",
            paginate: {
                first:      "Primero",
                previous:   "Anterior",
                next:       "Siguiente",
                last:       "Ultimo"
            },
            aria: {
                sortAscending:  ": Se ordenan las columnas por orden creciente",
                sortDescending: ": Se ordenan las columnas por orden decreciente"
            }
        },
         "columns": [
            { "orderable": false },
            { "orderable": false },
            { "orderable": false },
            null,
            null,
            null
        ]
    };

    var opciones2 = {
      bFilter: false,
      ordering: false,
      responsive: true,
        "language": {
            search:         "Buscar:",
            searchPlaceholder: "",
            lengthMenu:     "Mostrar _MENU_ entradas",
            info:           "Mostrando _START_ a _END_ de _TOTAL_ entradas.",
            infoEmpty:      "Mostrando 0 a 0 de 0 entradas",
            infoFiltered:   "(filtradas de _MAX_ entradas en total)",
            infoPostFix:    "",
            loadingRecords: "Carga en curso...",
            zeroRecords:    "No se encontraron usuarios en la busqueda",
            emptyTable:     "No hay informacion disponible en la tabla",
            processing:     "Procesando...",
            paginate: {
                first:      "Primero",
                previous:   "Anterior",
                next:       "Siguiente",
                last:       "Ultimo"
            },
            aria: {
                sortAscending:  ": Se ordenan las columnas por orden creciente",
                sortDescending: ": Se ordenan las columnas por orden decreciente"
            }
        },
         "columns": [
            { "orderable": false },
            { "orderable": false },
            { "orderable": false },
            null,
            null,
            null,
            null,
            null,
            null
        ]
    };

    var opciones3 = {
      bFilter: false,
      ordering: false,
      responsive: true,
        "language": {
            search:         "Buscar:",
            searchPlaceholder: "",
            lengthMenu:     "Mostrar _MENU_ entradas",
            info:           "Mostrando _START_ a _END_ de _TOTAL_ entradas.",
            infoEmpty:      "Mostrando 0 a 0 de 0 entradas",
            infoFiltered:   "(filtradas de _MAX_ entradas en total)",
            infoPostFix:    "",
            loadingRecords: "Carga en curso...",
            zeroRecords:    "No se encontraron usuarios en la busqueda",
            emptyTable:     "No hay informacion disponible en la tabla",
            processing:     "Procesando...",
            paginate: {
                first:      "Primero",
                previous:   "Anterior",
                next:       "Siguiente",
                last:       "Ultimo"
            },
            aria: {
                sortAscending:  ": Se ordenan las columnas por orden creciente",
                sortDescending: ": Se ordenan las columnas por orden decreciente"
            }
        },
         "columns": [
            { "orderable": false },
            { "orderable": false },
            { "orderable": false },
            null,
            null,
            null,
            null,
            null,
            null
        ]
    };

    var opciones4 = {
      bFilter: false,
      ordering: false,
      responsive: true,
        "language": {
            search:         "Buscar:",
            searchPlaceholder: "",
            lengthMenu:     "Mostrar _MENU_ entradas",
            info:           "Mostrando _START_ a _END_ de _TOTAL_ entradas.",
            infoEmpty:      "Mostrando 0 a 0 de 0 entradas",
            infoFiltered:   "(filtradas de _MAX_ entradas en total)",
            infoPostFix:    "",
            loadingRecords: "Carga en curso...",
            zeroRecords:    "No se encontraron usuarios en la busqueda",
            emptyTable:     "No hay informacion disponible en la tabla",
            processing:     "Procesando...",
            paginate: {
                first:      "Primero",
                previous:   "Anterior",
                next:       "Siguiente",
                last:       "Ultimo"
            },
            aria: {
                sortAscending:  ": Se ordenan las columnas por orden creciente",
                sortDescending: ": Se ordenan las columnas por orden decreciente"
            }
        },
         "columns": [
            { "orderable": false },
            { "orderable": false },
            { "orderable": false },
            null,
            null,
            null,
            null,
            null,
            null
        ]
    };

    var cantidadColumnas = $("#RechazadasTable thead th").length;
    columnas2 = [];
    for (var i = 0; i<cantidadColumnas; i++){
      columnas2.push({ "orderable": false });
    }
    opciones2["columns"] = columnas2;
    $("#RechazadasTable").DataTable(opciones2);

    var cantidadColumnas = $("#ValidadasTable thead th").length;
    columnas = [];
    for (var i = 0; i<cantidadColumnas; i++){
      columnas.push({ "orderable": false });
    }
    opciones["columns"] = columnas;
    $("#ValidadasTable").DataTable(opciones);

    var cantidadColumnas = $("#BorradoresTable thead th").length;
    columnas4 = [];
    for (var i = 0; i<cantidadColumnas; i++){
      columnas4.push({ "orderable": false });
    }
    opciones4["columns"] = columnas4;
    $("#BorradoresTable").DataTable(opciones4);

    var cantidadColumnas = $("#PorValidarTable thead th").length;
    columnas3 = [];
    for (var i = 0; i<cantidadColumnas; i++){
      columnas3.push({ "orderable": false });
    }
    opciones3["columns"] = columnas3;
    $("#PorValidarTable").DataTable(opciones3);
  });
</script>

    <!-- <div class="container">  -->

    <br>

    <div class="row">
        <div class="col-md-12">
        <!-- Nav tabs -->
        <div class="card">
        <ul class="nav nav-tabs" role="tablist">

        <!-- Validados -->
        <li role="presentation" class="active act">
            <a  href="#activas"
                aria-controls="activas"
                role="tab"
                data-toggle="tab">
                Validados
            </a>
        </li>

        <!-- Por Validar -->
        <li role="presentation" class="esp">
            <a  href="#espera"
                aria-controls="espera"
                role="tab"
                data-toggle="tab">
                Por Validar
            </a>
        </li>

        <!-- No Validados -->
        <li role="presentation" class="rec">
            <a  href="#rechazadas"
                aria-controls="rechazadas"
                role="tab"
                data-toggle="tab">
                No Validados
            </a>
        </li>

        <!-- Borradores -->
        <li role="presentation" class="esp">
            <a  href="#borradores"
                aria-controls="borradores"
                role="tab"
                data-toggle="tab">
                Borradores
            </a>
        </li>


        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
        <!-- Activas -->
        <div role="tabpanel" class="tab-pane active" id="activas">
                    <table id='ValidadasTable' class="table table-hover table-striped borde-tabla" style="margin:0px !important; width: 100% !important">
                        <thead>
                          <tr>
                                <th class="hColumns">Nombre</th>
                                <th class="hColumns text-center">Editar</th>
                                <th class="hColumns text-center">Descargar</th>
                                <th class="hColumns text-center">Eliminar</th>
                        </tr>
                        </thead>
                        <tbody id="actividades">
                          {{if cant_val == 0:}}
                              <tr class="clickable">
                                <td class="hColumns" colspan="7"> No tienes productos validados</td>
                                <th class="hColumns"></th>
                                <th class="hColumns"></th>
                                <th class="hColumns text-center"></th>
                              </tr>
                          {{else:}}
                            {{for x in rows:}}
                                {{if x.estado == 'Validado':}}
                                <tr class="clickable">
                                    <!-- Nombre

                                    <td class="center-vertically detalles" data-toggle="modal"
                                    data-target="#myModal" data-producto={{=x.id_producto}}> -->
                                    <td class="hColumns center-vertically detalles">{{=x.nombre}}</td>

                                    <!-- Boton Modificar -->
                                    <td class="hColumns text-center center-vertically">
                                        <span class="glyphicon glyphicon-edit" style="color:#9E9E9E"></span>
                                    </td>

                                    <!-- Boton Descargar -->
                                    <td class="hColumns text-center center-vertically">
                                  <!--  {{=IMG(_src=URL('static', 'icon/i_download.png'),_height='25',_title="Descargar") }} -->
                                        <a href='/{{=request.application}}/{{=request.controller}}/get_pdf/{{=x.id_producto}}'
                                        class="glyphicon glyphicon-save blue" target="blanck" title="Imprimir Producto {{=x.id_producto}}"></a>
                                    </td>

                                    <!-- Boton Eliminar -->
                                    <td class="hColumns text-center center-vertically">
                                        <span class="glyphicon glyphicon-remove" style="color:#9E9E9E"></span>
                                    </td>
                                </tr>
                                {{pass}}
                            {{pass}}
                          {{pass}}
                        </tbody>
                    </table>
        </div>
        <!-- Por Validar -->
        <div role="tabpanel" class="tab-pane" id="espera">
                    <table id='PorValidarTable' class="table table-hover table-striped borde-tabla" style="margin:0px !important; width: 100% !important">
                        <thead>
                          <tr>
                                <th class="hColumns">Nombre</th>
                                <th class="hColumns">Tipo Actividad</th>
                                <th class="hColumns">Modificación</th>
                                <th class="hColumns">Finalización</th>
                                <th class="hColumns text-center">Editar</th>
                                <th class="hColumns text-center">Descargar</th>
                                <th class="hColumns text-center">Eliminar</th>
                          </tr>
                        </thead>
                        <tbody id="actividades">
                          {{if cant_esp == 0:}}
                            <tr class="clickable">
                              <td class="hColumns" colspan="7"> No tienes productos por validar</td>
                              <th class="hColumns"></th>
                              <th class="hColumns"></th>
                              <th class="hColumns text-center"></th>
                              <th class="hColumns text-center"></th>
                              <th class="hColumns"></th>
                              <th class="hColumns"></th>
                            </tr>
                          {{else:}}
                            {{for x in rows:}}
                                {{if x.estado == 'Por Validar':}}
                                    <tr class="clickable">
                                        <!-- Nombre Producto -->

                                        <td class="hColumns center-vertically detalles">{{=x.nombre}}</td>
                                        <!-- Nombre Actividad -->
                                        <td class="hColumns center-vertically detalles"> {{=nombres[x]}}</td>
                                        <!-- Modificacion -->
                                        <td class="hColumns center-vertically"> {{=x.fecha_realizacion}}</td>
                                        <!-- Realizacion  -->
                                        <td class="hColumns center-vertically"> {{=x.fecha_modificacion}}</td>
                                        <!-- Boton Modificar -->
                                        <td class="hColumns text-center center-vertically">
                                            <span class="glyphicon glyphicon-edit" style="color:#9E9E9E"></span>
                                        </td>
                                        <!-- Boton Descargar -->
                                        <td class="hColumns text-center center-vertically">
                                            <a href='/{{=request.application}}/{{=request.controller}}/get_pdf/{{=x.id_producto}}'
                                            class="glyphicon glyphicon-save blue" target="blanck" title="Imprimir Producto {{=x.id_producto}}"></a>
                                        </td>
                                        <!-- Boton Eliminar -->
                                        <td class="hColumns text-center center-vertically">
                                            <span class="glyphicon glyphicon-remove" style="color:#9E9E9E"></span>
                                        </td>
                                    </tr>
                                {{pass}}
                            {{pass}}
                          {{pass}}
                        </tbody>
                    </table>

        </div>

        <!-- No Validados -->
        <div role="tabpanel" class="tab-pane" id="rechazadas">
                    <table id='RechazadasTable' class="table table-hover table-striped borde-tabla"  style="margin:0px !important; width: 100% !important">
                        <thead>
                            <tr>
                                <th class="hColumns">Nombre</th>
                                <th class="hColumns">Tipo Actividad</th>
                                <th class="hColumns">Ult. Modificación</th>
                                <th class="hColumns text-center">Editar</th>
                                <th class="hColumns text-center">Descargar</th>
                                <th class="hColumns text-center">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody id="actividades">
                          {{if cant_rec == 0:}}
                              <tr class="clickable">
                                <td class="hColumns">  No tienes productos no validados</td>
                                <th class="hColumns"></th>
                                <th class="hColumns"></th>
                                <th class="hColumns text-center"></th>
                                <th class="hColumns text-center"></th>
                                <th class="hColumns"></th>
                              </tr>
                          {{else:}}
                            {{for x in rows:}}
                                {{if x.estado == 'No Validado':}}
                                <tr class="clickable">
                                    <td class="hColumns center-vertically detalles"> {{=x.nombre}}</td>
                                    <td class="hColumns center-vertically detalles"> {{=nombres[x]}}</td>
                                    <td class="hColumns center-vertically"> <!-- Modificacion --> {{=x.fecha_modificacion}}</td>
                                    <!-- Boton Modificar -->
                                    <td class="hColumns text-center center-vertically">
                                        <a href="{{=URL('modificar',args=x.id)}}">
                                        <!-- {{=IMG(_src=URL('static', 'icon/i_edit.png'),_height='25',_title="Modificar") }} -->
                                            <span class="glyphicon glyphicon-edit green-icn"></span>
                                        </a>
                                    </td>
                                    <!-- Boton Descargar -->
                                    <td class="hColumns text-center center-vertically">
                                        <!--      {{=IMG(_src=URL('static', 'icon/i_download.png'),_height='25',_title="Descargar") }} -->
                                        <a href='/{{=request.application}}/{{=request.controller}}/get_pdf/{{=x.id_producto}}'
                                        class="glyphicon glyphicon-save blue" target="blanck" title="Imprimir Producto {{=x.id_producto}}"></a>
                                    </td>
                                    <!-- Boton Eliminar -->
                                    <td class="hColumns text-center center-vertically">
                                        <a onClick = "if(confirm('¿Está seguro de que desea eliminar este producto?')) {window.location.href = '{{=URL(f='eliminar',args=[ x.id ] )}}';}">
                                        <!-- {{=IMG(_src=URL('static', 'icon/i_delete.png'),_height='25',_title="Eliminar") }} -->
                                            <span class="glyphicon glyphicon-remove red"></span>
                                        </a>
                                    </td>
                                </tr>
                                {{pass}}
                            {{pass}}
                          {{pass}}
                        </tbody>
                  </table>

        </div>
        <!-- Borradores -->
        <div role="tabpanel" class="tab-pane" id="borradores">
                    <table id='BorradoresTable' class="table table-hover table-striped borde-tabla" style="margin:0px !important; width: 100% !important">
                        <thead>
                            <tr>
                                <th class="hColumns">Nombre</th>
                                <th class="hColumns">Tipo Actividad</th>
                                <th class="hColumns">Ult. Modificación</th>
                                <th class="hColumns text-center">Editar</th>
                                <th class="hColumns text-center">Eliminar</th>
                            </tr>
                        </thead>
                        <tbody id="actividades">
                          {{if cant_bor == 0:}}
                              <tr class="clickable">
                                <td class="hColumns">No tienes productos guardados como borrador</td>
                                <th class="hColumns"></th>
                                <th class="hColumns"></th>
                                <th class="hColumns text-center"></th>
                                <th class="hColumns text-center"></th>
                              </tr>
                          {{else:}}

                            {{for x in rows:}}
                                {{if x.estado == 'Borrador':}}
                                <tr class="clickable">
                                    <td class="hColumns center-vertically detalles"> {{=x.nombre}}</td>
                                    <td class="hColumns center-vertically detalles"> {{=nombres[x]}}</td>
                                    <td class="hColumns center-vertically"> <!-- Modificacion --> {{=x.fecha_modificacion}}</td>
                                    <!-- Boton Modificar -->
                                    <td class="hColumns text-center center-vertically">
                                        <a href="{{=URL('modificar',args=x.id)}}">
                                        <!-- {{=IMG(_src=URL('static', 'icon/i_edit.png'),_height='25',_title="Modificar") }} -->
                                            <span class="glyphicon glyphicon-edit green-icn"></span>
                                        </a>
                                    </td>
                                    <!-- Boton Eliminar -->
                                    <td class="hColumns text-center center-vertically">
                                        <a onClick = "if(confirm('¿Está seguro de que desea eliminar este producto?')) {window.location.href = '{{=URL(f='eliminar',args=[ x.id ] )}}';}">
                                        <!-- {{=IMG(_src=URL('static', 'icon/i_delete.png'),_height='25',_title="Eliminar") }} -->
                                            <span class="glyphicon glyphicon-remove red"></span>
                                        </a>
                                    </td>
                                </tr>
                                {{pass}}
                            {{pass}}
                          {{pass}}
                        </tbody>
                    </table>

        </div>
        </div>
        </div>
        </div>
        </div>

    <!-- Modal -->
    <div id="myModalAgregar" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <center><h4 class="modal-title"> Agregar Producto </h4><center>
          </div>
          <div class="modal-body">
              <form method="post" class="form-horizontal" role="form">

                    <!--Seleccion de Programa-->
                    <div class="form-group">
                        <label for="programa" class = "control-label col-sm-4"> Programa(*)</label>
                        <div class="col-sm-8">
                            <select class= "form-control" name="programa" onchange="ajax('obtener_actividades', ['programa'], ':eval')">
                                <option selected=""></option>
                                {{for x in programas:}}
                                <option value="{{=x['nombre']}}">{{=x['nombre']}}</option>

                                {{pass}}
                            </select>
                        </div>
                        <br><br>
                        <div id="descripcion_programa"></div>
                    </div>

                    <!-- Filtro de Tipo de Actividad -->
                    <div class="form-group">
                        <label for="id_tipo" class = "control-label col-sm-4">
                            Tipo Actividad (*)
                        </label>
                        <div class="col-sm-8 ">
                            <select class="form-control" name="id_tipo" id="lista_tipos" >
                                <!--Con el ajax traemos las actividades-->
                            </select>

                        </div>
                    </div>
                    <div class="form-group ">
                        <input type="submit" class="col-sm-offset-3 col-sm-8 btn blue-add btn-border " value="Agregar" />
                        <input type="hidden" name="_formname" value="crear_tipo" />
                    </div>
                </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div id="myModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title"><center>Detalles de Producto</center></h4>
          </div>
          <div class="modal-body">
            <p>Some text in the modal.</p>
          </div>
          <div class="modal-footer">
          <center>
            <button type="button" class="btn btn-default" data-dismiss="modal">Cerrar</button>
            </center>
          </div>
        </div>

      </div>
    </div>

{{end}}

{{block script}}

    <!-- SCRIPT PARA MOSTRAR Y OCULTAR DETALLES -->
    <script src="{{=URL('static','js/showDetails.js')}}"
            type="text/javascript">
    </script>


    <!-- SCRIPT PARA PAGINAR TABLA DE ACTIVIDADES -->
    <script src="{{=URL('static','js/pagintable.js')}}"
            type="text/javascript">
    </script>
{{end}}
